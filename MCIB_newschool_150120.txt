<?xml version="1.0" encoding="UTF-8"?>
<config xmlns="http://web-harvest.sourceforge.net/schema/1.0/config" scriptlang="groovy">

<var-def name="mcib_path">
       <template>C:\Users\r09113389\Desktop\MCIB\Uploads\</template>
</var-def>

<var-def name="MCIB_webPortal">
       <template>http://muubhemapp0006.corp.dsarena.com:8090/mcib/</template>
</var-def>

<var-def name="portal_user">
       <template>MAUBOT13</template>
</var-def>

<var-def name="portal_pwd">
       <template>London11</template>
</var-def>



	<robotics-flow>
		<robot driver="universal" close-on-completion="false"
			start-in-private="false">
			<capability name="SEARCH_ALL_WINDOWS" value="true" />
			<capability name="CLOSE_ALL_WINDOWS" value="false" />
			<script><![CDATA[
			//http://mupbhemapp0005.corp.dsarena.com:8090/barclays-mcib/
			
			import java.text.SimpleDateFormat;
			import java.util.Arrays;
			import java.util.ArrayList;
			import java.util.Iterator;
			import java.util.regex.Matcher;
			import java.util.regex.Pattern;
			import java.util.function.Predicate;
			
			Date datos = new Date();
			String currdt_folder = new SimpleDateFormat("dd.MM.yyyy").format(datos);
			String currmonth_folder = new SimpleDateFormat("M MMMM").format(datos);
			
			
			///////////////////////////////////LOGIN////////////////////////////////////
			timeouts().pageLoadTimeout(180000, java.util.concurrent.TimeUnit.MILLISECONDS)
			openChrome(MCIB_webPortal.toString());
			//pageLoadTimeout(180000);
			$(byXpath('//input[@name="username"]')).sendKeys(portal_user);
			$(byXpath('//input[@name="password"]')).sendKeys(portal_pwd);
			$(byXpath('//button[@class="btn btn-primary pull-right"]')).click();
			sleep(1000);

			///////////////////////////////////LOGIN////////////////////////////////////
			
			
			////////////////////////////OVERDRAFT WITH NO LIMIT/////////////////////////
			
			log.info("----Overdraft with no limit----");
			
			//UPLOAD
			openChrome(MCIB_webPortal.toString()+"?upload");
			
			//choose file
			$$(byXpath("//*[@id='datafile']")).get(2).click();
			switchTo().window('[CLASS:#32770;TITLE:Open]');
			sendKeys(mcib_path.toString()+currmonth_folder+"\\"+currdt_folder+"\\overdraft limit.txt");//-----------------change path
			$('[CLASS:Button;NAME:Open]').click();
			
			//upload button
			$(byXpath("//input[@value='Upload OVD No Limit']")).click();
			
			//rows uploaded xpath--/html/body/div[3]/div[2]/div/div[1]/div/div/span
			String color =  $(byXpath("/html/body/div[3]/div[2]/div/div[1]/div/div/span")).getText();

			String advanced_color = color.trim();
			String[] spring = advanced_color.split("\\.");
			second_phrase = spring[1];
			String second_phrase_evolution = second_phrase.trim();
			String[] rez = second_phrase_evolution.split(" ");
			String overdraft_rows = rez[0]
			
			log.info("No of rows uploaded---"+ overdraft_rows);
			
			//upload success
			if(color.contains("Import completed")){
				
				log.info("Import Completed");
				//PROCESS
				openChrome(MCIB_webPortal.toString()+"?overdraftnolimit/process");
				
				String color_process = $(byXpath("/html/body/div[3]/div[2]/div/form/div[1]/div/label")).getText();
				String[] spring_process = color_process.split(" ");
				String overdraft_process_rows = spring_process[0];
				
				log.info("No of rows to be processed--"+ overdraft_process_rows);
				
				//compare uploaded and to be processed
				if(Integer.parseInt(overdraft_rows) == Integer.parseInt(overdraft_process_rows)){
					
					log.info("Records Matched")
					//process button
					$(byXpath("//button[@name='process']")).click();
					
					String color_post_process = $(byXpath("/html/body/div[3]/div[2]/div/div/div/div")).getText();
					println(color_post_process);
					
					//CLOSE
					openChrome(MCIB_webPortal.toString()+"?overdraftnolimit/close");
					
					String color_close = $(byXpath("/html/body/div[3]/div[2]/div/form/div[1]/div/label")).getText();
					println(color_close);
				}
				
			}
			
			////////////////////////////OVERDRAFT WITH NO LIMIT/////////////////////////
			
			
			]]></script>
		</robot>
	</robotics-flow>
    <export include-original-data="true"></export>

</config>