<?xml version="1.0" encoding="UTF-8"?>
<config xmlns="http://web-harvest.sourceforge.net/schema/1.0/config" scriptlang="groovy">

<var-def name="mcib_path">
       <template>C:\Users\r09113389\Desktop\MCIB\Uploads\</template>
</var-def>

<var-def name="MCIB_webPortal">
       <template>http://mupbhemapp0005.corp.dsarena.com:8090/barclays-mcib/</template>
</var-def>

<var-def name="portal_user">
       <template>MAUBOT13</template>
</var-def>

<var-def name="portal_pwd">
       <template>London01</template>
</var-def>



	<robotics-flow>
		<robot driver="universal" close-on-completion="false"
			start-in-private="false">
			<capability name="SEARCH_ALL_WINDOWS" value="true" />
			<capability name="CLOSE_ALL_WINDOWS" value="false" />
			<script><![CDATA[
			//http://mupbhemapp0005.corp.dsarena.com:8090/barclays-mcib/
			
			import java.text.SimpleDateFormat;
			
			Date datos = new Date();
			String currdt_folder = new SimpleDateFormat("dd.MM.yyyy").format(datos);
			String currmonth_folder = new SimpleDateFormat("M MMMM").format(datos);
			

			///////////////////////////////////LOGIN////////////////////////////////////
			timeouts().pageLoadTimeout(180000, java.util.concurrent.TimeUnit.MILLISECONDS)
			openChrome(MCIB_webPortal.toString());
			//pageLoadTimeout(180000);
			$(byXpath('//input[@name="username"]')).sendKeys(portal_user);
			$(byXpath('//input[@name="password"]')).sendKeys(portal_pwd);
			$(byXpath('//button[@class="btn blue pull-right"]')).click();
			sleep(1000);

			///////////////////////////////////LOGIN////////////////////////////////////
			
			
			////////////////////////////OVERDRAFT WITH NO LIMIT/////////////////////////
			
			//UPLOAD
			openChrome(MCIB_webPortal.toString()+"?upload");
			
			//choose file
			$$(byXpath("//*[@id='datafile']")).get(2).click();
			switchTo().window('[CLASS:#32770;TITLE:Open]');
			sendKeys(mcib_path.toString()+currmonth_folder+"\\"+currdt_folder+"\\MCIB_upload.txt");//---------------------------change path
			$('[CLASS:Button;NAME:Open]').click();
			
			//upload button
			//$(byXpath("//input[@value='Upload OVD No Limit']")).click();
			
			//PROCESS
			openChrome(MCIB_webPortal.toString()+"?overdraftnolimit/process");
			
			
			//comparison
			//records that needs to be processed xpath--/html/body/div[3]/div[2]/div/form/div[1]/div/label
			println("RECORDS TO BE PROCESSED-->" + $(byXpath("/html/body/div[3]/div[2]/div/form/div[1]/div/label")).getText());
			
			//must match before
			$(byXpath("//button[@name='process']")).click();
			
			//imported rows xpath--/html/body/div[3]/div[2]/div/div/div/div/span/text()[1]
			println("IMPORTED ROWS-->" + $(byXpath("/html/body/div[3]/div[2]/div/div/div/div/span")).getText());
			//rejected rows xpath--/html/body/div[3]/div[2]/div/div/div/div/span/text()[2]
			//println("REJECTED ROWS-->" + $(byXpath("/html/body/div[3]/div[2]/div/div/div/div/span/text()[2]")).getText());
			
			//CLOSE
			openChrome(MCIB_webPortal.toString()+"?overdraftnolimit/close");
			
			//close check
			//products to close xpath--/html/body/div[3]/div[2]/div/form/div[1]/div/label
			
			//close button
			try{
				
				
			}catch(Exception e){}
			
			////////////////////////////OVERDRAFT WITH NO LIMIT/////////////////////////
			
			
			]]></script>
		</robot>
	</robotics-flow>
    <export include-original-data="true"></export>

</config>